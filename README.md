# DishRecognizer
This project aims to train and predict using Google's Inception model which is implemented using Tensorflow. This repo defines a two bash scripts for the following purposes:
1. To generate tensorflow model files from raw images 
2. To use the generated model files to predict given an image

## Prerequisites:
1. Installed tensorflow with GPU support. For further instruction check this [link](https://www.tensorflow.org/install/).
2. Installed the following packages for python:
    * Regex package "re"
    * Argument parser "argparse"
    * Image library "pillow"
    * Requests Library "requests"
    * Pprint 
    * Jsbeautifier

## Get started
First you have to create the model by executing the ```create_models.sh``` file. For that execute it as follows
```
./create_models.sh 
Enter the directory for the dataset[Example:~/dataset] ~/datatset
Enter the path for tensorflow[Example:~/tensorflow] ~/tensorflow
.
.
.
```

This script generates the necessary model and label files required by the prediction. More detail on the dataset structure is given in the next section.
Optionally you can also pass an input files to the script as shown in ```input.txt``` like so
```
./create_models.sh < input.txt
```

## PART 1: Generating Tensorflow model files from Raw Dataset
The script ```create_models.sh``` asks the user for two inputs. The first one is the directory for the cloned tensorflow repository. For example if the cloned directory resides in the ```$HOME``` folder of the user, the appropriate input for this would be ```/home/dev/tensorflow``` or simply ```~/tensorflow```. User should take note that environment variables are not handled as part of the script e.g ```$HOME```, ```$PWD``` etc. The second input to this would be the directory where the raw images reside in a categorized fashion. Therefore your directory structure could be as follows:

```
~/dataset/burgers/burger_type_1/001.jpg
~/dataset/burgers/burger_type_1/002.jpg
.
.
.
~/dataset/burgers/burger_type_3/001.jpg
.
.
.
~/dataset/french_fries/001.jpg
.
.
.
~/dataset/french_fries/100.jpg
.
.
.
```

We see that in the dataset the folder burger has subfolders defining each individual type of burger while in french fries there are no categories. The training works as follows:
1. It first trains a large outer model which will classify an image into one of the broader categories. Therefore, given a dish the outer model will detect whether it is a burger or a french fry.
2. If the output is french fry, then the prediction stops there since there are no additional categories to look for. However, in case of a burger further predictions are required to determine which exact type of burger it is. For this prediction a sub model focused only on burgers is created by the ```create_models.sh```
3. The script creates an ```Output_graphs``` folder which houses the all the models in it e.g. ```Outer.pb``` and ```Outer.txt```(For the broader classification), ```burgers.pb``` and ```burgers.txt```(For a classification among burgers) and so on.
4. Additionally a temporary folder is also created which houses all the temporary.

NOTE: The creation of models involves a cleaning up of the folder names as they can produce bugs while folder traversal. `sanitize.py` removes all special characters in a folder name and retains all the spaces. Doing so modifies the folder name of the ORIGINAL dataset.  The next step is to predict using the .pb and .txt files generated.

## Part 2: Prediction
On clicking a picture of a dish, the trained model will predict what the exact dish is and the restaurant that made the dish.

## Getting started

Extract the Prediction folder from the tar file after cloning the DishRecognizer repository to your working directory.

There are two ways to make a prediction on an image.

- [Command line method](#cmd)
- [Endpoint method](#endpoint)

### <a name="cmd"></a> Command line method
- `absolute/path/to/image.jpg`
- `absolute/path/to/restaurant_models/`

For example

`$ ./predictor.sh /path/to/image.jpg /path/to/restaurant_models/`

The output of this will be stored in a text file called `prediction.txt`. This file is automatically generated by the `predicitor.sh` script in the `Predictions` directory.

**What does the restaurant models directory contain?**

 The restaurant models directory contains multiple sub directories which are named after the restaurant. The directory structure is as follows.

```
 /user/home/restaurant_models/BurgerKing
 /user/home/restaurant_models/TenderGreens
 .
 .
 .
 .
 /user/home/restaurant_models/inNoutBurger
```

Each restaurant directory contain the `Outer.pb`
and `Outer.txt` files. These files are used for prediciting the category of the dish from the input image. The folders may also contain some files like `burger.pb`,`burger.txt`,`salad.pb`,`salad.txt`, etc. These files contain the information required to perform a specific dish prediction.

### <a name="endpoint"></a> Endpoint Method
This method allows an image to be submitted via an API call. This internally calls `predictor.sh` with the default path to the restaurant models directory set as `/home/dev/restaurant_models`.

**NOTE: To change the path to the restaurant models directory, set it [here](#linkToSetRestModelPath). (_give a command which will let the developer to set the directory_)**

###TODO

- [ ] add more details about endpoint.
